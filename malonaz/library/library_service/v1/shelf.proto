syntax = "proto3";

package malonaz.library.library_service.v1;

import "buf/validate/validate.proto";
import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "google/protobuf/field_mask.proto";
import "malonaz/codegen/aip/v1/aip.proto";
import "malonaz/library/v1/shelf.proto";

option go_package = "github.com/malonaz/core/genproto/library/library_service/v1";

// Request message for LibraryService.CreateShelf.
message CreateShelfRequest {
  // The parent organization.
  // Format: organizations/{organization}
  string parent = 1 [
    (buf.validate.field).required = true,
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "library.malonaz.com/Organization"
  ];

  // The ID to use for the resource.
  string shelf_id = 2 [
    (buf.validate.field).ignore = IGNORE_IF_ZERO_VALUE,
    (buf.validate.field).string = {
      min_len: 1
      max_len: 63
      pattern: "^[a-z0-9](-?[a-z0-9])*$"
    }
  ];

  // The shelf to create.
  malonaz.library.v1.Shelf shelf = 3 [(buf.validate.field).required = true];

  // A unique identifier for this request.
  string request_id = 4 [
    (buf.validate.field).ignore = IGNORE_IF_ZERO_VALUE,
    (buf.validate.field).string.uuid = true
  ];

  // If set, validate the request and preview the response, but do not actually create the resource.
  bool validate_only = 5;
}

// Request message for LibraryService.GetShelf.
message GetShelfRequest {
  // The resource name of the shelf to retrieve.
  // Format: organizations/{organization}/shelves/{shelf}
  string name = 1 [
    (buf.validate.field).required = true,
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "library.malonaz.com/Shelf"
  ];
}

// Request message for LibraryService.UpdateShelf.
message UpdateShelfRequest {
  option (malonaz.codegen.aip.v1.update) = {
    paths: [
      "display_name",
      "genre",
      "metadata.*"
    ]
  };
  option (buf.validate.message).cel = {
    id: "shelf.name_required"
    message: "shelf.name must be set"
    expression: "has(this.shelf.name)"
  };

  // The shelf to update.
  malonaz.library.v1.Shelf shelf = 1 [(buf.validate.field).ignore = IGNORE_ALWAYS];

  // The list of fields to update.
  google.protobuf.FieldMask update_mask = 2 [(buf.validate.field).required = true];
}

// Request message for LibraryService.DeleteShelf.
message DeleteShelfRequest {
  // The resource name of the shelf to delete.
  // Format: organizations/{organization}/shelves/{shelf}
  string name = 1 [
    (buf.validate.field).required = true,
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "library.malonaz.com/Shelf"
  ];

  // If true, and the shelf is not found, the request will succeed
  // but no action will be taken on the server.
  bool allow_missing = 2;
}

// Request message for LibraryService.ListShelves.
message ListShelvesRequest {
  option (malonaz.codegen.aip.v1.pagination) = {default_page_size: 100};
  option (malonaz.codegen.aip.v1.ordering) = {
    paths: [
      "create_time",
      "update_time",
      "display_name"
    ]
    default: "create_time desc"
  };
  option (malonaz.codegen.aip.v1.filtering) = {
    paths: ["*"]
  };

  // The parent organization to list shelves for.
  // Format: organizations/{organization}
  string parent = 1 [
    (buf.validate.field).required = true,
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "library.malonaz.com/Organization"
  ];

  // @autogen
  string filter = 2;

  // If set to true, soft deleted resources will be shown.
  bool show_deleted = 3;

  // @autogen.
  string order_by = 4;

  // Requested page size.
  int32 page_size = 5 [(buf.validate.field).int32 = {
    gte: 0
    lte: 1000
  }];

  // A page token, received from a previous `ListShelves` call.
  string page_token = 6;
}

// Response message for LibraryService.ListShelves.
message ListShelvesResponse {
  // The list of shelves.
  repeated malonaz.library.v1.Shelf shelves = 1;

  // A token to retrieve the next page.
  string next_page_token = 2;
}
