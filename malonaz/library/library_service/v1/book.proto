syntax = "proto3";

package malonaz.library.library_service.v1;

import "buf/validate/validate.proto";
import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "google/protobuf/field_mask.proto";
import "malonaz/codegen/aip/v1/aip.proto";
import "malonaz/library/v1/book.proto";

option go_package = "github.com/malonaz/core/genproto/library/library_service/v1";

// Request message for LibraryService.CreateBook.
message CreateBookRequest {
  // The parent shelf.
  // Format: organizations/{organization}/shelves/{shelf}
  string parent = 1 [
    (buf.validate.field).required = true,
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "library.malonaz.com/Shelf"
  ];

  // The ID to use for the resource.
  string book_id = 2 [
    (buf.validate.field).ignore = IGNORE_IF_ZERO_VALUE,
    (buf.validate.field).string = {
      min_len: 1
      max_len: 63
      pattern: "^[a-z0-9](-?[a-z0-9])*$"
    }
  ];

  // The book to create.
  malonaz.library.v1.Book book = 3 [(buf.validate.field).required = true];

  // A unique identifier for this request.
  string request_id = 4 [
    (buf.validate.field).ignore = IGNORE_IF_ZERO_VALUE,
    (buf.validate.field).string.uuid = true
  ];

  // If set, validate the request and preview the response, but do not actually create the resource.
  bool validate_only = 5;
}

// Request message for LibraryService.GetBook.
message GetBookRequest {
  // The resource name of the book to retrieve.
  // Format: organizations/{organization}/shelves/{shelf}/books/{book}
  string name = 1 [
    (buf.validate.field).required = true,
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "library.malonaz.com/Book"
  ];
}

// Request message for LibraryService.UpdateBook.
message UpdateBookRequest {
  option (malonaz.codegen.aip.v1.update) = {
    paths: [
      "title",
      "author",
      "isbn",
      "publication_year",
      "page_count",
      "metadata.*"
    ]
  };
  option (buf.validate.message).cel = {
    id: "book.name_required"
    message: "book.name must be set"
    expression: "has(this.book.name)"
  };

  // The book to update.
  malonaz.library.v1.Book book = 1 [(buf.validate.field).ignore = IGNORE_ALWAYS];

  // The list of fields to update.
  google.protobuf.FieldMask update_mask = 2 [(buf.validate.field).required = true];
}

// Request message for LibraryService.DeleteBook.
message DeleteBookRequest {
  // The resource name of the book to delete.
  // Format: organizations/{organization}/shelves/{shelf}/books/{book}
  string name = 1 [
    (buf.validate.field).required = true,
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "library.malonaz.com/Book"
  ];

  // If true, and the book is not found, the request will succeed
  // but no action will be taken on the server.
  bool allow_missing = 2;

  // If set, the request will only succeed if the current etag matches this value.
  string etag = 3;
}

// Request message for LibraryService.ListBooks.
message ListBooksRequest {
  option (malonaz.codegen.aip.v1.pagination) = {default_page_size: 100};
  option (malonaz.codegen.aip.v1.ordering) = {
    paths: [
      "create_time",
      "update_time",
      "title",
      "publication_year"
    ]
    default: "create_time desc"
  };
  option (malonaz.codegen.aip.v1.filtering) = {
    paths: [
      "title",
      "author",
      "isbn",
      "publication_year",
      "metadata.*",
      "labels"
    ]
  };

  // The parent shelf to list books for.
  // Format: organizations/{organization}/shelves/{shelf}
  string parent = 1 [
    (buf.validate.field).required = true,
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference).type = "library.malonaz.com/Shelf"
  ];

  // @autogen
  string filter = 2;

  // @autogen.
  string order_by = 3;

  // Requested page size.
  int32 page_size = 4 [(buf.validate.field).int32 = {
    gte: 0
    lte: 1000
  }];

  // A page token, received from a previous `ListBooks` call.
  string page_token = 5;
}

// Response message for LibraryService.ListBooks.
message ListBooksResponse {
  // The list of books.
  repeated malonaz.library.v1.Book books = 1;

  // A token to retrieve the next page.
  string next_page_token = 2;
}
