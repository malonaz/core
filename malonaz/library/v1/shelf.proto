syntax = "proto3";

package malonaz.library.v1;

import "buf/validate/validate.proto";
import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "google/protobuf/timestamp.proto";
import "malonaz/codegen/model/v1/model.proto";

option go_package = "github.com/malonaz/core/genproto/library/v1";

// Shelf represents a categorized collection of books.
message Shelf {
  option (google.api.resource) = {
    type: "library.malonaz.com/Shelf"
    pattern: "organizations/{organization}/shelves/{shelf}"
    singular: "shelf"
    plural: "shelves"
  };
  option (malonaz.codegen.model.v1.model_opts) = {};

  // The resource name of the shelf.
  // Format: organizations/{organization}/shelves/{shelf}
  string name = 1 [(google.api.field_behavior) = IDENTIFIER];

  // The creation timestamp.
  google.protobuf.Timestamp create_time = 2 [(google.api.field_behavior) = OUTPUT_ONLY];
  // The last update timestamp.
  google.protobuf.Timestamp update_time = 3 [(google.api.field_behavior) = OUTPUT_ONLY];
  // The deletion timestamp.
  google.protobuf.Timestamp delete_time = 4 [
    (malonaz.codegen.model.v1.field_opts).nullable = true,
    (google.api.field_behavior) = OUTPUT_ONLY
  ];

  // The display name of the shelf.
  string display_name = 5 [(buf.validate.field).string = {
    min_len: 1
    max_len: 256
  }];

  // The genre of books on this shelf.
  ShelfGenre genre = 6 [(buf.validate.field).enum = {
    defined_only: true
    not_in: [0]
  }];

  // The labels on this shelf.
  map<string, string> labels = 7 [
    (malonaz.codegen.model.v1.field_opts).as_json_bytes = true,
    (malonaz.codegen.model.v1.field_opts).nullable = true,
    (buf.validate.field).map = {
      max_pairs: 64
      keys: {
        string: {pattern: "^([a-zA-Z0-9]([a-zA-Z0-9.-]{0,251}[a-zA-Z0-9])?/)?[a-zA-Z0-9]([a-zA-Z0-9_.-]{0,61}[a-zA-Z0-9])?$"}
      }
      values: {
        string: {
          max_len: 63
          pattern: "^[a-z0-9_\\-\\p{L}]*$"
        }
      }
    }
  ];

  // Shelf metadata.
  ShelfMetadata metadata = 8 [(malonaz.codegen.model.v1.field_opts).as_json_bytes = true];
}

// Metadata for a shelf.
message ShelfMetadata {
  // Maximum capacity of books on this shelf.
  int32 capacity = 1;
}

// Genre categories for shelves.
enum ShelfGenre {
  // Used to detect an unset field.
  SHELF_GENRE_UNSPECIFIED = 0;
  // Fiction books.
  SHELF_GENRE_FICTION = 1;
  // Non-fiction books.
  SHELF_GENRE_NON_FICTION = 2;
  // Science fiction books.
  SHELF_GENRE_SCIENCE_FICTION = 3;
  // History books.
  SHELF_GENRE_HISTORY = 4;
  // Biography books.
  SHELF_GENRE_BIOGRAPHY = 5;
}
