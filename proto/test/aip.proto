syntax = "proto3";

package test.aip.v1;

import "google/protobuf/field_mask.proto";
import "proto/codegen/aip.proto";

option go_package = "github.com/malonaz/core/genproto/test/aip";

// MyEnum is a test enum for filter validation.
enum MyEnum {
  // Unspecified enum.
  MY_ENUM_UNSPECIFIED = 0;
  // Some specified value.
  MY_ENUM_VALUE = 1;
}

// ListResourcesRequest tests list operation with filters, ordering, and aliases.
message ListResourcesRequest {
  option (malonaz.core.codegen.aip.v1.list) = {
    default_page_size: 1000
    order_by: [
      "id",
      "create_timestamp",
      "update_timestamp"
    ]
    aliases: [
      {
        key: "replaceable_field"
        value: "replaced_field"
      }
    ]
    filters: [
      {
        field: "id"
        primitive: STRING
      },
      {
        field: "replaceable_field"
        primitive: STRING
      },
      {
        field: "json_field"
        primitive: STRING
      },
      {
        field: "json_field@key"
        primitive: STRING
      },
      {
        field: "json_field@key@key2"
        primitive: STRING
      },
      {
        field: "create_timestamp"
        primitive: INT64
      },
      {
        field: "update_timestamp"
        primitive: INT64
      },
      {
        field: "deleted"
        primitive: BOOL
      },
      {
        field: "my_enum"
        enum: "test.aip.v1.MyEnum"
      }
    ]
  };

  // Filter expression for resources.
  string filter = 1;
  // Maximum number of resources to return.
  int32 page_size = 2;
  // Pagination token from previous response.
  string page_token = 3;
  // Ordering clause for results.
  string order_by = 4;
}

// Resource is a test message with nested fields.
message Resource {
  // Simple string field.
  string field1 = 1;
  // Nested resource for path mapping tests.
  NestedResource nested = 2;
  // Second nested resource for full object updates.
  NestedResource nested2 = 3;
  // Third nested resource for multi-column mapping.
  NestedResource nested3 = 4;
  // Fourth nested resource for wildcard mapping.
  NestedResource nested4 = 5;
  // Enum field for filter testing.
  MyEnum my_enum = 6;
}

// NestedResource contains fields for testing nested path updates.
message NestedResource {
  // Boolean field.
  bool field1 = 1;
  // Integer field for selective updates.
  int64 field2 = 2;
  // String field.
  string field3 = 3;
}

// UpdateResourceRequest tests field mask with path mappings and authorization.
message UpdateResourceRequest {
  option (malonaz.core.codegen.aip.v1.update) = {
    path_mappings: [
      {
        from: "field1"
        to: ["field_one"]
      },
      {
        from: "nested.field2"
        to: ["nested_field_two"]
      },
      {
        from: "nested2"
        to: ["nested2"]
      },
      {
        from: "nested4.*"
        to: ["nested4_jsonb"]
      },
      {
        from: "nested3"
        to: [
          "field1",
          "field1",
          "field2"
        ]
      }
    ]
    authorized_paths: [
      {path: "field1"},
      {path: "nested.field2"},
      {path: "nested2"},
      {path: "nested"},
      {path: "nested4.field1"},
      {path: "nested4.field3"},
      {path: "nested3"}]
  };

  // Resource to update.
  Resource resource = 1;
  // Field mask specifying which fields to update.
  google.protobuf.FieldMask update_mask = 2;
}

// UpdateResource2Request tests default paths with authorized paths.
message UpdateResource2Request {
  option (malonaz.core.codegen.aip.v1.update) = {
    default_paths: ["field1"]
    authorized_paths: [
      {path: "nested"},
      {path: "nested2"}]
  };

  // Resource to update.
  Resource resource = 1;
  // Field mask specifying which fields to update.
  google.protobuf.FieldMask update_mask = 2;
}
